{% load static %}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Required meta tags -->
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<!-- Document Title -->
		<title>Vertical Tabs CSS Using HTML & JavaScript</title>


		<!-- Icon Fonts -->
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

		<!-- Google Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&family=Source+Sans+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet" />





     <!-- Load favicon -->
    <link
      rel="shortcut icon"
      type="image/png"
      href="{% static 'img/favicon.ico' %}"
    />

    <!-- Include your CSS files here -->
    <link
      rel="preload"
      as="style"
      href="{% static 'css/inventory.css' %}"
      onload="this.rel = 'stylesheet'"
    />

    <title>Inventory</title>
</head>
<body class="home">
		<div class="site-wrapper">
			<section class="article-wrapper">
				<div class="article-container">
					<div class="article-block">
						<div class="entry-content">
							<h1>Restaurant Inventory System</h1>
						</div>
					</div>
				</div>
			</section>
			<section class="tabs-wrapper">
				<div class="tabs-container">
					<div class="tabs-block">
						<div id="tabs-section" class="tabs">
							<ul class="tab-head">
								<li>
									<a href="#tab-0" class="tab-link active"> 
                                      <span class="material-symbols-outlined">
lunch_dining
</span>
                                        <span class="tab-label"> Add Ingredients</span></a>
                                    
                                    
								</li>
                                <li>
									<a href="#tab-1" class="tab-link"> 
                                      <span class="material-symbols-outlined">
lunch_dining
</span>
                                        <span class="tab-label">Manage Ingredients</span></a>
                                    
                                    
								</li>
								<li>
									<a href="#tab-2" class="tab-link"> <span class="material-icons tab-icon">menu_book</span> <span class="tab-label">Add Menu items</span></a>
								</li>
                                <li>
									<a href="#tab-3" class="tab-link"> <span class="material-icons tab-icon">menu_book</span> <span class="tab-label">Manage Menu items</span></a>
								</li>
								<li>
									<a href="#tab-4" class="tab-link"> <span class="material-icons tab-icon">shopping_cart</span> <span class="tab-label">Purchases</span></a>
								</li>
								<li>
									<a href="#tab-5" class="tab-link"> <span class="material-icons tab-icon">paid</span> <span class="tab-label">Profits</span></a>
								</li>
								
							</ul>

							<section id="tab-0" class="tab-body entry-content active active-content">
								<h2>Ingredients</h2>
                                <form action="#" method="post">
         {% csrf_token %}
          {{form.as_p}}
        <input type="submit" value="Submit">
                                </form>
                                
                                {% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}
                                

                                
							</section>
    <section id="tab-1" class="tab-body entry-content">
								<h2>Ingredient Management</h2>
                                
                             <div id="ingredientContainer">
    <table id="ingredientList"></table> 
</div>

                                 
                                 
                                 

							</section>
                        
                           
							<section id="tab-2" class="tab-body entry-content">
								<h2>Menu item</h2>
                                
                                    Coming soon
							</section>

                           
                        
							<section id="tab-3" class="tab-body entry-content">
								<h2>Purchases</h2>
								                                    Coming soon

                            </section>

							<section id="tab-4" class="tab-body entry-content">
								<h2>Profits and Reports</h2>
								                                    Coming soon

							</section>

							
						</div>
					</div>
				</div>
			</section>

        <div id="editIngredientModal" class="modal">
    <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <h2>Edit Ingredient</h2>
        <form  action = "#" id="editIngredientForm">
            {% csrf_token %}
            <input type="hidden" id="ingredientId" name="ingredientId">
            <label for="ingredientName">Name:</label>
            <input type="text" id="ingredientName" name="ingredientName">
            <label for="unitPrice">Unit Price:</label>
            <input type="number" id="unitPrice" name="unitPrice" step="0.01" min="0" placeholder="0.00">

            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" name="quantity" min="0">
            <button type="submit">Save Changes</button>
        </form>
    </div>
</div>
			<footer>
				<div class="credits"><a href="https://htmlcssfreebies.com/vertical-tabs-css/" target="_blank">Powered by Vertical Tabs CSS Template</a> by HTMLCSSFreebies.</div>
			    <article>
      <p>Copyright {{ current_year }} Little Lemon</p>
    </article>
            </footer>
		</div>
		<!-- Javascript Files -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<script src="{% static 'js/app.js' %}"></script>
        <script>
            $.ajax({
    url: '/inventory/admin/getIngredients',  // Django endpoint URL
    type: 'GET',
    success: function(response) {
        // Handle the JSON response from the Django endpoint
        console.log("the ingredients are");
        console.log(response); // Log the ingredient data

        // Update  frontend with the ingredient data
        displayIngredients(response);
    },
    error: function(xhr, status, error) {
        // Handle errors (e.g., display an error message to the user)
        console.error('AJAX Error:', error); 
    }
});

function displayIngredients(ingredients) {
    const ingredientList = $('#ingredientList'); 
    ingredientList.empty();

    // Start with the table structure
    ingredientList.append('<table></table>');
    const table = ingredientList.find('table');

    // Table header (optional but recommended)
    table.append('<tr><th>Ingredient</th><th>Quantity</th><th>Unit</th></tr>'); 

    for (const ingredient of ingredients) {
        // Ensure properties exist before using them
        const quantity = ingredient.qty || ""; 
        const unit = ingredient.unit_price || "";

        // Create table rows dynamically
        table.append(`
            <tr>
                <td>${ingredient.name}</td>
                <td>${quantity}</td>
                <td>${unit}</td> 
<td>
                    <button class="edit" id=edit_${ingredient.id}>Edit</button>
                    <button class="delete-btn" >Delete</button>
                </td>
            </tr>
        `);


        const editingredientButtonId = document.getElementById("edit_"+ingredient.id);
            console.log(editingredientButtonId);
            editingredientButtonId.addEventListener("click", () => {
            editIngredient("edit_"+ingredient.id, ingredient.name,unit,quantity);
    });

    }




$('#ingredientList').on('click', '.delete-btn', function() {
    const index = $(this).data('index');
    const ingredient = ingredients[index];
    alert("Delete button clicked for "+ingredient);


});
    
    
    
}

function editIngredient(id,name,price,qty) {
     // Get references to modal elements
    const modal = document.getElementById("editIngredientModal");
    const ingredientIdInput = document.getElementById("ingredientId");
    const ingredientNameInput = document.getElementById("ingredientName");
    const ingredientPriceInput = document.getElementById("unitPrice");
    const ingredientQtyInput = document.getElementById("quantity");
  
    const form = document.getElementById("editIngredientForm");

    // Fill modal with existing data
    ingredientIdInput.value = id;
    ingredientNameInput.value = name;
    ingredientPriceInput.value = price;
    ingredientQtyInput.value = qty;

    // Show the modal
    modal.style.display = "block";

    // Handle form submission
    form.addEventListener("submit", (event) => {
        event.preventDefault(); // Prevent default form submission
        const csrfToken = getCookie('csrftoken');
        // Get updated values from the form
        const updatedId = ingredientIdInput.value;
        const updatedName = ingredientNameInput.value;
        const updatedPrice = ingredientPriceInput.value;
        const updatedQty = ingredientQtyInput.value;
        
        
        
        
        const idValue = id.split("_");

        fetch('/inventory/admin/ingredientsUpdate/'+idValue[1]+'/', {
            method: 'PUT', 
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({ 
    id: idValue[1],
    name: updatedName,
    price: updatedPrice,  
    quantity: updatedQty  
})
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok.');
            }
            // Handle successful update (e.g., close modal, refresh list)
            console.log("sucessfull update of ingredient");
            closeModal();
        })
        .catch(error => {
            console.error('There was a problem with the fetch operation:', error);
            // Handle errors (e.g., show error message)
        });
        
        
    });



}
function closeModal() {
    document.getElementById("editIngredientModal").style.display = "none";
}

function getCookie(name) {
			const value = `; ${document.cookie}`;
			const parts = value.split(`; ${name}=`);
			if (parts.length === 2) return parts.pop().split(';').shift();
		}



        </script>
	</body>
</html>